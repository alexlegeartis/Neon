\RequirePackage{tikz}
\newcommand{\footimage}[1]{\def\footim@ge{#1}}

\setbeamerfont{structure}{series=\bf,family=\sffamily,size=\Large}
\setbeamerfont{attention title}{series=\bf,size=\Large}
\setbeamerfont{attention body}{}

\setbeamertemplate{itemize/enumerate body begin}{\vspace*{-0.3em}}
\setbeamertemplate{itemize/enumerate body end}{\vspace*{-0.3em}}

\setbeamertemplate{itemize item}{\huge\blacktriangleright }
\setbeamertemplate{itemize subitem}{\bullet }
\setlength\leftmargini{3.5em}

% Attention block environment - for important observations, theorems, etc.
% Usage: \begin{attention}[Optional Title] ... \end{attention}
% If no title is given, the block will have no header
\newenvironment{attention}[1][]{%
  \vskip0.2em
  % Start the tikz border frame
  \begin{tikzpicture}
    \node[
      draw=HazySummerEve,
      fill=AlwaysBeBabyToMe,
      line width=2pt,
      inner sep=1em,
      rounded corners=8pt
    ] (box) \bgroup
    \begin{minipage}{\dimexpr\linewidth-4em\relax}
  % Only show title if one is provided
  \ifx&#1&%
    % No title provided - skip the title box
  \else%
    % Title provided - show it
    {\usebeamerfont{attention title}\usebeamercolor[fg]{attention title}#1\par}%
    \vskip0.5em
  \fi%
  \usebeamerfont{attention body}\usebeamercolor[fg]{attention body}%
}{%
  \end{minipage}%
  \egroup;
  \end{tikzpicture}%
  \vskip0.2em
}

\setbeamertemplate{navigation symbols}{}
\setbeamerfont{footline}{size=\small,family=\rmfamily}

\newlength{\authorblockheight}
\newsavebox{\authorblockcontent}

\newcommand{\defineauthorblock}[1]{%
  % We save the author content (your tabularx) directly into a box.
  % The unnecessary \parbox wrapper has been removed.
  % THE FIX: We wrap the content in a \parbox of a defined width.
  % This forces the tabularx inside to correctly calculate its column widths
  % *before* we measure the final height. \textwidth is the correct width here.
  \sbox{\authorblockcontent}{\parbox{\textwidth}{\usebeamercolor[fg]{footline}#1}}%
  % CORRECTED: Use \settototalheight to measure the full vertical size (height + depth).
  \settototalheight{\authorblockheight}{\usebox{\authorblockcontent}}%
  % We add some vertical padding for aesthetics. Adjust this value to your taste.
  \addtolength{\authorblockheight}{8ex}%
}

% --- FINAL HEADLINE: Using \leavevmode and minipage ---
\setbeamertemplate{headline}{  
  \begin{beamercolorbox}[wd=\textwidth]{headline}%
    \leavevmode% THIS IS THE CRUCIAL COMMAND
    \begin{minipage}[c][\authorblockheight][c]{\textwidth}%
      \centering{\usebeamercolor{title in headline}\color{fg}{\bfseries\rmfamily\fontsize{82}{90}\selectfont\inserttitle}}%
    \end{minipage}%
  \end{beamercolorbox}%
  
  \begin{beamercolorbox}[wd=\paperwidth]{lower separation line head}
    \rule{0pt}{1em}
  \end{beamercolorbox}
}


% --- FINAL FOOTLINE: Also using \leavevmode and minipage ---
\setbeamertemplate{footline}{
  \begin{beamercolorbox}[wd=\paperwidth]{upper separation line foot}
    \rule{0pt}{.5em}
  \end{beamercolorbox}%
   \begin{beamercolorbox}[wd=\paperwidth]{footline}%
     \leavevmode% ADD THE CRUCIAL COMMAND HERE TOO
     \begin{minipage}[c][\authorblockheight][c]{\linewidth}%
       \centering\usebox{\authorblockcontent}%
     \end{minipage}%
   \end{beamercolorbox}%
%
\ifdefined\footim@ge
  \tikz[overlay,remember picture]%
  \node[anchor=south east,inner sep=0pt] at (current page.south east) %
  {\footim@ge};
\fi
}
